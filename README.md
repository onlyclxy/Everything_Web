# Everything Web Server

一个基于Go语言的文件搜索和媒体服务器，用于替代Everything的原生HTTP服务，支持在线播放mkv等视频格式和图片预览。

## 功能特性

✅ **文件搜索**: 集成Everything的`es.exe`命令行工具，提供快速文件搜索
✅ **分页显示**: 支持分页显示搜索结果，可设置每页20-200条结果
✅ **视频播放**: 支持在线播放多种视频格式（MP4, MKV, AVI, MOV, WMV, FLV, WebM）
✅ **独立播放器**: 视频在新窗口独立播放，不影响搜索页面
✅ **图片预览**: 支持图片缩略图显示和预览
✅ **Range请求**: 支持HTTP Range请求，实现视频拖拽和断点续传
✅ **详细日志**: 完整的服务器日志记录，便于问题诊断
✅ **播放监控**: 实时监控视频播放状态和错误信息
✅ **现代界面**: 美观的Web界面，响应式设计
✅ **文件下载**: 支持直接下载文件
✅ **路径导航**: 点击路径可以打开文件或文件夹

## 支持的文件格式

### 视频格式
- MP4, MKV, AVI, MOV, WMV, FLV, WebM

### 图片格式  
- JPG, JPEG, PNG, GIF, BMP, WebP

## 系统要求

- Windows 操作系统
- Go 1.24+ 
- Everything软件（需要es.exe命令行工具）

## 安装和使用

### 方法一：使用批处理文件（推荐）

1. **启动服务器**（最简单）
   ```bash
   # 双击运行 start.bat
   start.bat
   ```

2. **停止服务器**
   ```bash
   # 双击运行 stop.bat
   stop.bat
   ```

3. **手动编译**
   ```bash
   # 双击运行 build.bat
   build.bat
   ```

4. **清理编译文件**
   ```bash
   # 双击运行 clean.bat
   clean.bat
   ```

### 方法二：命令行操作

1. **编译程序**
   ```bash
   go build -o everything-web-server.exe main.go
   ```

2. **运行编译后的程序**
   ```bash
   .\everything-web-server.exe
   ```

3. **或直接运行源码**
   ```bash
   go run main.go
   ```

4. **访问Web界面**
   ```
   http://localhost:8080
   ```

## 新功能详解

### 分页显示
- **每页条目数**: 可选择每页显示20、50、100、200条结果
- **智能分页**: 自动计算总页数，提供页码导航
- **搜索统计**: 显示搜索结果总数和当前页信息
- **快速翻页**: 支持上一页/下一页，首页/末页跳转

### 详细日志
服务器会记录以下信息：
- 搜索请求和结果统计
- 文件访问和下载记录
- 视频播放请求和流传输状态
- Range请求处理详情
- 错误诊断和性能监控

### 独立视频播放器
- **新窗口播放**: 视频在独立窗口打开，不影响搜索
- **播放监控**: 实时显示播放状态和进度
- **错误诊断**: 详细的错误信息和代码
- **播放日志**: 记录加载、播放、暂停等事件
- **文件信息**: 显示视频文件大小、路径等信息

## API端点

### 搜索API（支持分页）
```
GET /api/search?q=搜索关键词&page=页码&pageSize=每页条数
```

### 视频播放器页面
```
GET /video/视频文件路径
```

### 文件下载
```
GET /file/文件路径
```

### 视频流媒体
```
GET /stream/视频文件路径
```

### 图片缩略图
```
GET /thumbnail/图片文件路径
```

## 项目结构

```
everything-web-server/
├── main.go                      # 主服务器文件
├── everything-web-server.exe    # 编译后的可执行文件
├── es.exe                       # Everything命令行工具
├── go.mod                       # Go模块文件
├── start.bat                    # 启动脚本
├── stop.bat                     # 停止脚本
├── build.bat                    # 编译脚本
├── clean.bat                    # 清理脚本
└── README.md                    # 项目说明
```

## 使用说明

### 基本操作
1. **搜索文件**: 在搜索框中输入关键词，按Enter或点击搜索按钮
2. **设置分页**: 选择每页显示的条目数（20-200条）
3. **翻页导航**: 使用页码按钮或上一页/下一页按钮
4. **播放视频**: 点击视频文件的"播放"按钮，会在新窗口打开独立播放器
5. **查看图片**: 图片文件会显示缩略图，点击可查看原图
6. **下载文件**: 点击"下载"按钮可下载文件到本地
7. **打开文件夹**: 点击文件夹名称可浏览文件夹内容

### 视频播放器功能
- **播放控制**: 支持播放、暂停、拖拽进度条
- **全屏模式**: 支持全屏播放
- **播放监控**: 底部显示播放日志和状态信息
- **错误诊断**: 如果播放失败，会显示详细错误信息
- **返回功能**: 可以返回搜索页面或下载视频文件

## 批处理文件说明

- **start.bat**: 一键启动服务器（自动检查并编译，显示新功能说明）
- **stop.bat**: 安全停止服务器进程
- **build.bat**: 编译Go源码为可执行文件
- **clean.bat**: 清理编译生成的文件

## 常见问题

### 端口被占用
如果出现"bind: Only one usage of each socket address"错误：
1. 运行 `stop.bat` 停止现有服务器
2. 或手动结束占用8080端口的进程
3. 重新运行 `start.bat`

### 视频播放问题
如果视频无法播放：
1. 查看视频播放器页面底部的日志信息
2. 检查服务器控制台的详细日志
3. 确认视频文件格式是否支持
4. 尝试下载视频文件到本地播放

### 搜索结果过多
如果搜索结果太多：
1. 使用更精确的搜索关键词
2. 调整每页显示条目数
3. 使用分页功能浏览结果

### 中文乱码
批处理文件已添加UTF-8编码支持，如果仍有乱码：
1. 右键点击PowerShell窗口标题栏
2. 选择"属性" -> "字体"
3. 选择支持中文的字体

## 技术特性

- **高性能**: 使用Go语言开发，处理速度快
- **低内存**: 流式处理大文件，内存占用低
- **分页优化**: 智能分页减少内存使用，提升响应速度
- **详细日志**: 完整的请求和错误日志，便于问题定位
- **兼容性**: 支持各种浏览器的HTML5视频播放
- **安全性**: 基本的路径验证和文件类型检查
- **便携性**: 编译后单文件部署，无需安装Go环境

## 开发计划

- [x] 分页功能
- [x] 详细日志记录
- [x] 独立视频播放器
- [ ] 文件夹浏览功能
- [ ] 视频缩略图生成
- [ ] 搜索历史记录
- [ ] 文件上传功能
- [ ] 用户认证系统
- [ ] 播放列表功能

## 许可证

MIT License 